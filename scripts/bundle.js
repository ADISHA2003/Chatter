(()=>{function e(e,t){e.innerHTML="";let n=!1,o="";for(let e=0;e<t.length;e++)"**"===t.substring(e,e+2)?(n=!n,o+=n?"<strong>":"</strong>",e++):"\n"===t.charAt(e)?o+="<br>":o+=t.charAt(e);e.innerHTML=o;const s=document.getElementById("chat-box");s.scrollTop=s.scrollHeight}async function t(e){const t=["AIzaSyD243qBbyjJvZcyNKMb84J1PjWsocxgcco","AIzaSyBn-1DwSjXpqV5nteGRxbiW-LvxS7pDz-Q","AIzaSyAtQtO2RDaXU1dr3OB8xAFK1uXOmgmfPes"];async function n(t){const n=`https://www.googleapis.com/customsearch/v1?key=${t}&cx=73ecbbd20d97b4289&q=${e}&num=10`,o=await fetch(n);if(403===o.status&&"quotaExceeded"===(await o.json()).error.errors[0].reason)throw new Error("Quota exceeded");return o.json()}for(const e of t)try{return(await n(e)).items||[]}catch(t){if("Quota exceeded"!==t.message)return console.error("Error fetching custom search results:",t),[];console.warn(`API key ${e} quota exceeded, trying next key...`)}throw new Error("All API keys have exceeded their quota limits")}window.onload=function(){document.getElementById("user-input").focus()},document.getElementById("close-button").addEventListener("click",(function(){document.getElementById("floating-window").style.display="none"})),document.getElementById("msg-btn").addEventListener("click",(function(t){t.preventDefault();const n=document.getElementById("user-input").value;var o,s,a;o=n,s=document.getElementById("chat-box"),(a=document.createElement("div")).className="user-message",a.textContent=o,s.appendChild(a),s.scrollTop=s.scrollHeight;const c={contents:[{parts:[{text:n}]}]};fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyAQCyDYG9EoGQwfC3RdgI3VhAMQN04G9ck",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then((e=>e.json())).then((t=>{var n,o,s;n=t.candidates[0].content.parts[0].text,o=document.getElementById("chat-box"),(s=document.createElement("div")).className="bot-message",o.appendChild(s),setTimeout((function(){e(s,n)}),1e3)})).catch((e=>{console.error("Error fetching data:",e)}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector("#sidebar-icon"),t=document.getElementById("sidebar"),n=document.body;e.addEventListener("click",(function(o){o.preventDefault(),t.classList.toggle("active"),n.classList.toggle("sidebar-open"),e.classList.toggle("fa-bars"),e.classList.toggle("fa-times")}))})),document.getElementById("searchButton").addEventListener("click",(async()=>{const n=document.getElementById("searchQuery").value,o=document.getElementById("searchResults"),s=document.getElementById("search-box"),a=document.getElementById("loading");o.innerHTML="",s.innerHTML="",a.classList.remove("hidden");try{const c=await t(n);a.classList.add("hidden"),o.innerHTML=c.map((e=>'<p><strong><a href="'+e.link+'" target="_blank">'+e.title+"</a></strong>: "+e.snippet+"</p>")).join(""),e(s,await async function(e){const n="Based on these search results, generate a response that also includes your own knowledge, give latest and accurate information:\n\n"+(await t(e)).map((e=>e.title+": "+e.snippet)).join("\n");return await async function(e){const t={contents:[{parts:[{text:e}]}]};try{const e=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyAQCyDYG9EoGQwfC3RdgI3VhAMQN04G9ck",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await e.json();return n.candidates&&n.candidates[0].content.parts&&n.candidates[0].content.parts.length>0?n.candidates[0].content.parts[0].text.trim():(console.error("Invalid response format:",n),"Error: Invalid response format.")}catch(e){return console.error("Error fetching Gemini content:",e),"Error: Could not fetch content."}}(n)}(n))}catch(e){a.classList.add("hidden"),o.innerHTML="<p>Error fetching search results: "+e.message+"</p>",s.innerHTML="<p>Error: "+e.message+"</p>"}})),document.addEventListener("keydown",(function(e){if(e.shiftKey&&"Escape"===e.key){var t=document.getElementById("user-input");t&&(t.focus(),e.preventDefault())}})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("light-theme"),t=document.getElementById("dark-theme");function n(e){"light"===e?document.getElementById("theme-style").setAttribute("href","styles/light.css"):"dark"===e&&document.getElementById("theme-style").setAttribute("href","styles/dark.css"),localStorage.setItem("theme",e)}e.addEventListener("click",(function(e){e.preventDefault(),n("light")})),t.addEventListener("click",(function(e){e.preventDefault(),n("dark")})),function(){const e=localStorage.getItem("theme");e&&n(e)}()})),document.addEventListener("DOMContentLoaded",(e=>{function t(e,t,n,o){const s=document.getElementById(e),a=s.innerHTML;s.innerHTML='<i class="fas fa-spinner fa-spin"></i>';const c=1e3*Math.random();setTimeout((()=>{s.innerHTML=a}),n+c)}document.getElementById("searchButton").addEventListener("click",(function(){t("searchButton",0,3e3)})),document.getElementById("msg-btn").addEventListener("click",(function(){t("msg-btn",0,3e3)})),document.getElementById("search-btn").addEventListener("click",(function(){t("search-btn",0,3e3)}))}))})();
